<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="摘要 RAG在特定corpus QA任务上有 成熟应用，然而 大量反例 仍存在。它们不仅仅是LLMs的局限性导致，相反，它们主要由检索不准确信息导致，检索不准的原因是 1 现在RAG技术分块不考虑语义。2 丢失必要信息 和 过多噪声 之间的权衡。\n">
<title>SAGE_A_Framework_for_RAG_解读</title>

<link rel='canonical' href='https://rooobeam.github.io/p/sage_a_framework_for_rag_%E8%A7%A3%E8%AF%BB/'>

<link rel="stylesheet" href="/scss/style.min.a7558000c2456f20ae90904971171af41a2b987eed638982c918c424b3e14d7b.css"><meta property='og:title' content="SAGE_A_Framework_for_RAG_解读">
<meta property='og:description' content="摘要 RAG在特定corpus QA任务上有 成熟应用，然而 大量反例 仍存在。它们不仅仅是LLMs的局限性导致，相反，它们主要由检索不准确信息导致，检索不准的原因是 1 现在RAG技术分块不考虑语义。2 丢失必要信息 和 过多噪声 之间的权衡。\n">
<meta property='og:url' content='https://rooobeam.github.io/p/sage_a_framework_for_rag_%E8%A7%A3%E8%AF%BB/'>
<meta property='og:site_name' content='rooobeam'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-09-01T22:43:23&#43;08:00'/><meta property='article:modified_time' content='2025-09-01T22:43:23&#43;08:00'/>
<meta name="twitter:title" content="SAGE_A_Framework_for_RAG_解读">
<meta name="twitter:description" content="摘要 RAG在特定corpus QA任务上有 成熟应用，然而 大量反例 仍存在。它们不仅仅是LLMs的局限性导致，相反，它们主要由检索不准确信息导致，检索不准的原因是 1 现在RAG技术分块不考虑语义。2 丢失必要信息 和 过多噪声 之间的权衡。\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_51c49b55d0a39bb4.png" width="300"
                            height="299" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">😚</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">rooobeam</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/3461571462302229'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://blog.csdn.net/rooobeam?'
                        target="_blank"
                        title="CSDN"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-copyright"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /><path d="M14 9.75a3.016 3.016 0 0 0 -4.163 .173a2.993 2.993 0 0 0 0 4.154a3.016 3.016 0 0 0 4.163 .173" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/rooobeam?'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#摘要">摘要</a></li>
    <li><a href="#intruduction">INTRUDUCTION</a></li>
    <li><a href="#preliminaries预备知识">PRELIMINARIES(预备知识)</a>
      <ol>
        <li><a href="#rag-system-phases">RAG system phases:</a></li>
        <li><a href="#cost-of-llm-inference">Cost of LLM inference:</a></li>
        <li><a href="#cost-efficeincy-metric-in-rag">Cost efficeincy Metric in RAG:</a></li>
      </ol>
    </li>
    <li><a href="#overview">OVERVIEW</a>
      <ol>
        <li><a href="#a-vector-database-building-w">(A) Vector Database Building: W</a></li>
        <li><a href="#b-retrieval">(B) Retrieval:</a></li>
        <li><a href="#c-generation-based-on-llm">(C) Generation based on LLM:</a></li>
      </ol>
    </li>
    <li><a href="#semantic-segmentation">SEMANTIC SEGMENTATION</a>
      <ol>
        <li><a href="#high-level-idea">High-level Idea</a></li>
        <li><a href="#model-construction">Model Construction</a></li>
        <li><a href="#model-training">Model Training</a></li>
        <li><a href="#model-inference">Model Inference</a></li>
        <li><a href="#corpus-segmentation">Corpus Segmentation</a></li>
        <li><a href="#high-level-idea-1">High-level Idea</a></li>
        <li><a href="#gradient-based-selection">Gradient based Selection</a></li>
      </ol>
    </li>
    <li><a href="#llm-self-feedback">LLM SELF-FEEDBACK</a>
      <ol>
        <li><a href="#feedback-loop">Feedback Loop</a></li>
      </ol>
    </li>
    <li><a href="#experiments">EXPERIMENTS</a>
      <ol>
        <li><a href="#experimental-setup">Experimental Setup</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/sage_a_framework_for_rag_%E8%A7%A3%E8%AF%BB/">SAGE_A_Framework_for_RAG_解读</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-09-01</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="摘要">摘要
</h2><p>RAG在特定corpus QA任务上有 成熟应用，然而 大量反例 仍存在。它们不仅仅是LLMs的局限性导致，相反，它们主要由检索不准确信息导致，检索不准的原因是 1 现在RAG技术分块不考虑语义。2 丢失必要信息 和 过多噪声 之间的权衡。</p>
<p>本文提出一个RAG框架 SAGE。1 解决分块问题上，提出训练一个语义分块模型，能将corpus分成语义完整块。2 设计 一个chunk挑选算法，根据相似度的下降速度（delta）动态选择块。3 为进一步确保精度，提出让LLMs评估检索的块是excessive or lacking. 实验证明很牛逼。</p>
<h2 id="intruduction">INTRUDUCTION
</h2><p><strong>bg of problem &ndash; RAG</strong>: enhance a generation model&rsquo;s ability answer questions. With the rise of LLMs, RAG demonstrated proficiency in QA.</p>
<p><strong>Limitions overview</strong>:</p>
<p><strong>L1</strong>:</p>
<p><strong>challenge of addressing L1</strong>:</p>
<p><strong>L2</strong>:</p>
<p><strong>challenge of addressing L2</strong>:</p>
<p><strong>approach overview</strong>:</p>
<p><strong>contributions</strong>:</p>
<h2 id="preliminaries预备知识">PRELIMINARIES(预备知识)
</h2><h3 id="rag-system-phases">RAG system phases:
</h3><ul>
<li>vector DB construction: <strong>corpus</strong> is devided into <strong>chunks</strong>. Convert chunks into vector representations (embedding chunks). Stored these vectors.</li>
<li>Convert the received <strong>question</strong> into vector. (embedding question). Caculate similarity with chunks in vector DB and then identifying the top N chunks which serve as the <strong>context</strong> for an LLM.</li>
<li>The given question and context fixed into a prompt template forming a complete prompt. Feed the prompt to an LLM. It generates a response as the final answer.</li>
</ul>
<h3 id="cost-of-llm-inference">Cost of LLM inference:
</h3><p>​	The matrix is the money required to obtain ansers from an LLM. Typically, RAG use LLM provided by LLM providers. The charges based on the volume of input and output tokens. OpenAI’s  GPT-4 charge a lot.</p>
$$
Cost =  I_t \cdot c_i + O_t \cdot c_o
$$<p>​	<strong>I</strong>: input tokens; <strong>O</strong>: output tokens; <strong>c_i</strong>: cost per input token; <strong>o_i</strong>: cost per output token</p>
<h3 id="cost-efficeincy-metric-in-rag">Cost efficeincy Metric in RAG:
</h3>$$
f_{\text{cost-efficiency}} = \frac{Acc}{Cost}
$$<p>​	<strong>Acc</strong>: metrics used to eval the quality of an answer（ e.g. F1-Score, BELU-1, Accuracy）; <strong>Cost</strong> : money calcuated by the preceding equation.</p>
<p><img src="https://i-blog.csdnimg.cn/direct/9a8e28436fb944d4890b84e554a37e15.png"
	
	
	
	loading="lazy"
	
		alt="图片"
	
	
></p>
<p>(用网图链接有水印-.-)</p>
<h2 id="overview">OVERVIEW
</h2><h3 id="a-vector-database-building-w">(A) Vector Database Building: W
</h3><p>A given corpus is split into paragraphs  with &lsquo;\n&rsquo; initially (isn&rsquo;t shown in the figure).</p>
<ul>
<li>&ldquo;1 - 2&rdquo;: All those paragraphs are then <strong>segmented</strong> by a pretrained model into short but semantically complete chunks as T.</li>
<li>“3 - 4”: <strong>Embed</strong> chunks T into vectors.</li>
<li>&ldquo;5&rdquo;: <strong>Store</strong> vetors in a vector DB.</li>
</ul>
<h3 id="b-retrieval">(B) Retrieval:
</h3><p>A specific question is given.</p>
<ul>
<li>&ldquo;1 - 2&rdquo;: The given question is <strong>embedding</strong> into a vector.</li>
<li>“3 - 4”: Query the vector DB for topN chunk vectors that most align with question&rsquo;s vector, thereby <strong>retrieving</strong> the topN chunks.</li>
<li>&ldquo;5 - 6&rdquo;: Use a reranking model to <strong>rerank</strong> these N chunks into a new order (scored N chunks).</li>
<li>&ldquo;7 - 8&rdquo;: Select the top-ranking K chunks that come before the point where <strong>a significant dip in scores</strong> is ovserved</li>
</ul>
<h3 id="c-generation-based-on-llm">(C) Generation based on LLM:
</h3><p>Given the specific question and topK chunks from &ldquo;(B) Retrieval&rdquo;.</p>
<ul>
<li>&ldquo;1&rdquo;: Craft a <strong>prompt</strong> incorporating the question and the topK chunks. This process is tailed to the question&rsquo;s type.</li>
<li>&ldquo;2 - 3&rdquo;: Feed the prompt into an <strong>LLM</strong> to procure the response.</li>
<li>&ldquo;4 - 5&rdquo;: Organize three things (question, topK chunks, answer from &ldquo;2 - 3&rdquo;) into a feedback prompt and then submitting it to an LLM. Generating a response of <strong>the score of the answer and an assessmen(new K) of the chunks</strong>.</li>
<li>If the score is enough, execute &ldquo;6 - 7&rdquo;. Else, execute right-side &ldquo;6&rdquo; to adjust the parameter topK.</li>
<li>If the loop has been executed three times, execute &ldquo;6 - 7&rdquo; only.</li>
</ul>
<h2 id="semantic-segmentation">SEMANTIC SEGMENTATION
</h2><h3 id="high-level-idea">High-level Idea
</h3><p>corpus segmentation is crucial. Ineffective segmentation results in semantically incomplete chunks leading to irrelevant retrieval (demonstrated in 8. INSIGHTS OF RAG TASKS).</p>
<p>Two methods predominantly employed: &ldquo;fixed-size&rdquo; and &ldquo;fixed-size with sentence complete&rdquo;.</p>
<ul>
<li>&ldquo;fixed-size&rdquo; leads to incomplete sentence in chunks undermining coherence of chunks.</li>
<li>&ldquo;fixed-size with sentence complete&rdquo; breaks continous sentences seperated into different chunks distorting the meaning of a chunk (e.g. unclear references).</li>
<li>Increasing the fixed length can mitigate the issue of chunks having incomplete meanings while causing each chunk to contain an excessive amount of information which ruins the similarity caculation and brings more noise to LLM.</li>
<li>While employing a LLM for segmentation is a conceivable approach, it proves to be costly (demonestrated in 7. EXPERIMENT) and slow.</li>
</ul>
<p>We propose to develop a lightweight and effective segmentation model that ensure that each chunk is complete.</p>
<h3 id="model-construction">Model Construction
</h3><p>Segmentation model incorporates an embedding model and a Multi-layer Perceptron([pərˈseptrɑn]) (MLP) model.</p>
<ul>
<li>An Embedding model utilizing AnglE method, embeds two sentences into two vectors x1 and x2.</li>
<li>Feature augmentation receives x1 and x2 and then subtracct and mutiply them yielding x1-x2 and x1*x2.</li>
<li>A MLP model takes x1, x2, x1-x2 and  x1*x2 to  produce a score which determines wether to split or not.</li>
<li>The decision to make x1-x2 or x1*x2 are based on the observation that embedding still reflect semantic difference （cite Sentence-bert).</li>
</ul>
<h3 id="model-training">Model Training
</h3><p><img src="https://i-blog.csdnimg.cn/direct/f9dad4d0e41f473894138efda69fa01e.png"
	
	
	
	loading="lazy"
	
		alt="图片"
	
	
></p>
<ul>
<li>First, gather a substantial amount of semantically segmented training data. Recommend Wikipedia dataset where passages have been semantically segmented into paragraphs.</li>
<li>Construct triplet training data &lt;s1, s2, label&gt;: If s1 and s2 are consecutive([kən&rsquo;sekjətɪv]) within the same paragraph, label = 1 representing they should be grouped into the same chunk. Otherwise, label = 0 suggesting a break.</li>
<li>The procedure are detailed in the figure above. Keep fedding triplets to learn the parameters of the embedding model and MLP model utilizing SDG.</li>
</ul>
<h3 id="model-inference">Model Inference
</h3><ul>
<li>Each two sentences are put into the segmentation model to gain a score. If &lt; threshold (e.g., 0.5), then a split occur. Conversly, they retained within the same chunk.</li>
<li>Segmentation Model runs in parallel processing corpus swiftly. （&ldquo;For instance, gathering all pairs of sentences within a corpus and organize them into multiple batches, each with a size of 512.&rdquo;  batches是不是下面的粗粒度chunks？）</li>
</ul>
<h3 id="corpus-segmentation">Corpus Segmentation
</h3><ul>
<li>Give a corpus, segment it into coarse-grained([ˌkɔːrsˈɡreɪnd])  chunks with length of approximately <em>l</em> (I call it as &ldquo;large-fixed-size with sentence complete&rdquo;).</li>
<li>Subsequently, segmentation model evaluates each pair of adjacent sentences in these coarse-grained chunks.</li>
<li>（So the boarder of coarse-grained chunks is ingored? I think that&rsquo;s fine because each chunk is large enough.）</li>
</ul>
<p>GRADIENT-BASED CHUNK SELECTION</p>
<p><img src="https://pic2.zhimg.com/v2-37521c9bc74bccdfe33684444ec10c9f_1440w.jpg"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h3 id="high-level-idea-1">High-level Idea
</h3><ul>
<li>Advanced RAG system typically leverage a reranking model to assess first-stage retrieval result (<strong>N</strong> chunks) with a given question. Subsequently, with the relevance scores assigned by the reranking model, top <strong>K</strong> chunks are selected as context for QA.</li>
<li>The idea of using a large K to avoid missing key chunks will lead to an overload of irrelevant chunks, which may confuse LLMs (illustrated in EXPERIMENTS).</li>
<li>Figure above shows two general cases, in which if chunks preceding a sharp decline on score are selected can easily get the correct answer (demonstrated in EXPERIMENTS).</li>
</ul>
<h3 id="gradient-based-selection">Gradient based Selection
</h3><ul>
<li>
<p>With top K reranked chunks <strong>C_s</strong> and their corresponding scores <strong>S</strong>, preset minimum number <strong>min_k</strong> and threshold of gradient <strong>g</strong>.</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># chks S min_k g</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">chks</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">min_k</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">add_chks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_k</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">g</span><span class="p">:</span> <span class="c1"># didn&#39;t drop too much</span>
</span></span><span class="line"><span class="cl">            <span class="n">add_chks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">add_chks</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>(论文里的伪代码有错误：“score = C[k − 1];” 对不上 原文： “if the score of a chunk exceeds 1/g times the score of its predecessor”)</p>
</li>
</ul>
<h2 id="llm-self-feedback">LLM SELF-FEEDBACK
</h2><h3 id="feedback-loop">Feedback Loop
</h3><p>After feeding context and question to LLM for final answer, we need to assess the suitability of context and quality of current answer before presented to user finally. By prompt engineer, LLM&rsquo;s assessment consist of a evaluation score (1-10) and a context adjustment flag (-1/1).</p>
<p>Upon receiving score and flag, if the score is higher than a preset threshold e.g. 9, the current answer is qualified for user, else adjust the parameter min_k in chunks selection: -1 implies reducing min_k by one, 1 implies increasing min_k by one.</p>
<h2 id="experiments">EXPERIMENTS
</h2><h3 id="experimental-setup">Experimental Setup
</h3><p><strong>Large language models</strong>: GPT3.5 turbo, GPT4, GPT4-o-mini, UnifiedQA-3B.</p>
<p>Datasets:</p>
<ul>
<li>QuALITY: This dataset comprises multiple-choice questions based on articles around 5,000 tokens each, featuring a challenging portion, QuALITYHARD, with questions most annotators got wrong under time constraints.</li>
<li>QASPER:</li>
</ul>

</section>


    <footer class="article-footer">
    

    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 rooobeam
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
